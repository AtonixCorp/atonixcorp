version: "3.8"

# This file demonstrates how to override the docker-compose configuration
# for production with HTTPS support.
# 
# Usage: docker-compose -f docker-compose.local.main.yml -f docker-compose.prod.override.yml up

services:
  apache-proxy:
    # Override to use SSL vhosts configuration
    environment:
      - APACHE_SSL_ENABLED=true
    volumes:
      - ./docker/apache2/httpd.conf:/usr/local/apache2/conf/httpd.conf:ro
      - ./docker/apache2/vhosts-ssl.conf:/usr/local/apache2/conf.d/vhosts.conf:ro
      - ./docker/apache2/certs:/etc/apache2/certs:ro

  backend:
    environment:
      # Update these for production
      - ENVIRONMENT=production
      - DEBUG=False
      - USE_HTTPS=True
      - ALLOWED_HOSTS=atonixcorp.org,www.atonixcorp.org,api.atonixcorp.org,www.api.atonixcorp.org
      - CSRF_TRUSTED_ORIGINS=https://atonixcorp.org,https://www.atonixcorp.org,https://api.atonixcorp.org,https://www.api.atonixcorp.org

  frontend:
    environment:
      # Update API URL to use HTTPS
      - REACT_APP_API_URL=https://api.atonixcorp.org/api
      - REACT_APP_ENVIRONMENT=production
      - REACT_APP_FRONTEND_URL=https://atonixcorp.org
      - GENERATE_SOURCEMAP=false
