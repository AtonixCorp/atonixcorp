# Generated by Django 6.0.2 on 2026-02-27 17:21

import django.db.models.deletion
import uuid
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('services', '0014_platform_resources'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='AccessKey',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('key_id', models.CharField(db_index=True, editable=False, max_length=64, unique=True)),
                ('secret_hash', models.CharField(help_text='Bcrypt hash â€“ never store plaintext', max_length=255)),
                ('status', models.CharField(choices=[('active', 'Active'), ('inactive', 'Inactive'), ('deleted', 'Deleted')], db_index=True, default='active', max_length=20)),
                ('last_used', models.DateTimeField(blank=True, null=True)),
                ('last_used_region', models.CharField(blank=True, max_length=64)),
                ('last_used_service', models.CharField(blank=True, max_length=64)),
                ('created_from_ip', models.GenericIPAddressField(blank=True, null=True)),
                ('owner', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='access_keys', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='DDoSProtectionRule',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('resource_id', models.CharField(db_index=True, editable=False, max_length=64, unique=True)),
                ('name', models.CharField(db_index=True, max_length=255)),
                ('description', models.TextField(blank=True, null=True)),
                ('tags', models.JSONField(default=dict, help_text='Key-value tags for resource')),
                ('metadata', models.JSONField(default=dict, help_text='Additional metadata')),
                ('rule_type', models.CharField(choices=[('rate_limit', 'Rate Limit'), ('geo_block', 'Geo Block'), ('ip_block', 'IP Block'), ('challenge', 'Challenge (CAPTCHA)'), ('managed', 'Managed Rule')], default='rate_limit', max_length=20)),
                ('status', models.CharField(choices=[('active', 'Active'), ('disabled', 'Disabled'), ('learning', 'Learning Mode')], db_index=True, default='active', max_length=20)),
                ('priority', models.IntegerField(default=100)),
                ('conditions', models.JSONField(default=dict, help_text='Match conditions for this rule')),
                ('rate_limit_rps', models.IntegerField(blank=True, help_text='Requests per second limit', null=True)),
                ('block_countries', models.JSONField(default=list, help_text='ISO country codes to block')),
                ('block_ips', models.JSONField(default=list, help_text='CIDR ranges to block')),
                ('mitigations_count', models.BigIntegerField(default=0)),
                ('last_triggered', models.DateTimeField(blank=True, null=True)),
                ('owner', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='%(class)s_owned', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'DDoS Rule',
                'ordering': ['priority'],
            },
        ),
        migrations.CreateModel(
            name='DDoSAttackEvent',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('attack_type', models.CharField(choices=[('volumetric', 'Volumetric'), ('protocol', 'Protocol'), ('application', 'Application Layer'), ('reflection', 'Reflection/Amplification'), ('botnet', 'Botnet')], max_length=20)),
                ('status', models.CharField(choices=[('detected', 'Detected'), ('mitigating', 'Mitigating'), ('mitigated', 'Mitigated'), ('false_positive', 'False Positive')], db_index=True, default='detected', max_length=20)),
                ('source_ips', models.JSONField(default=list)),
                ('target_resource', models.CharField(max_length=255)),
                ('target_region', models.CharField(blank=True, max_length=64)),
                ('peak_rps', models.IntegerField(default=0)),
                ('peak_bps', models.BigIntegerField(default=0)),
                ('packets_dropped', models.BigIntegerField(default=0)),
                ('duration_secs', models.IntegerField(default=0)),
                ('started_at', models.DateTimeField()),
                ('ended_at', models.DateTimeField(blank=True, null=True)),
                ('owner', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='ddos_events', to=settings.AUTH_USER_MODEL)),
                ('rule_matched', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='services.ddosprotectionrule')),
            ],
            options={
                'ordering': ['-started_at'],
            },
        ),
        migrations.CreateModel(
            name='DevicePosture',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('device_id', models.CharField(db_index=True, max_length=128, unique=True)),
                ('device_name', models.CharField(max_length=255)),
                ('platform', models.CharField(choices=[('windows', 'Windows'), ('macos', 'macOS'), ('linux', 'Linux'), ('ios', 'iOS'), ('android', 'Android'), ('chromeos', 'ChromeOS')], max_length=20)),
                ('os_version', models.CharField(max_length=100)),
                ('posture_status', models.CharField(choices=[('compliant', 'Compliant'), ('non_compliant', 'Non-Compliant'), ('unknown', 'Unknown'), ('pending', 'Pending Assessment')], db_index=True, default='unknown', max_length=20)),
                ('is_managed', models.BooleanField(default=False)),
                ('disk_encrypted', models.BooleanField(default=False)),
                ('screen_lock', models.BooleanField(default=False)),
                ('antivirus_active', models.BooleanField(default=False)),
                ('os_patched', models.BooleanField(default=False)),
                ('firewall_active', models.BooleanField(default=False)),
                ('last_seen', models.DateTimeField(blank=True, null=True)),
                ('last_assessed', models.DateTimeField(blank=True, null=True)),
                ('posture_score', models.IntegerField(default=0, help_text='0-100 compliance score')),
                ('owner', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='devices', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-last_seen'],
            },
        ),
        migrations.CreateModel(
            name='IAMGroup',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('resource_id', models.CharField(db_index=True, editable=False, max_length=64, unique=True)),
                ('description', models.TextField(blank=True, null=True)),
                ('tags', models.JSONField(default=dict, help_text='Key-value tags for resource')),
                ('metadata', models.JSONField(default=dict, help_text='Additional metadata')),
                ('name', models.CharField(db_index=True, max_length=255, unique=True)),
                ('policies', models.JSONField(default=list, help_text='List of attached policy IDs')),
                ('member_count', models.IntegerField(default=0)),
                ('members', models.ManyToManyField(blank=True, related_name='iam_groups', to=settings.AUTH_USER_MODEL)),
                ('owner', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='%(class)s_owned', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'IAM Group',
                'verbose_name_plural': 'IAM Groups',
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='IAMPolicy',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('resource_id', models.CharField(db_index=True, editable=False, max_length=64, unique=True)),
                ('name', models.CharField(db_index=True, max_length=255)),
                ('description', models.TextField(blank=True, null=True)),
                ('tags', models.JSONField(default=dict, help_text='Key-value tags for resource')),
                ('metadata', models.JSONField(default=dict, help_text='Additional metadata')),
                ('policy_type', models.CharField(choices=[('managed', 'Managed Policy'), ('inline', 'Inline Policy'), ('service', 'Service Control Policy')], default='managed', max_length=20)),
                ('policy_document', models.JSONField(help_text='Policy document (JSON)')),
                ('version', models.CharField(default='2024-10-17', max_length=16)),
                ('is_atonix_managed', models.BooleanField(default=False, help_text='Managed by AtonixCorp')),
                ('attachment_count', models.IntegerField(default=0)),
                ('owner', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='%(class)s_owned', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'IAM Policy',
                'verbose_name_plural': 'IAM Policies',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='IAMRole',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('resource_id', models.CharField(db_index=True, editable=False, max_length=64, unique=True)),
                ('name', models.CharField(db_index=True, max_length=255)),
                ('description', models.TextField(blank=True, null=True)),
                ('tags', models.JSONField(default=dict, help_text='Key-value tags for resource')),
                ('metadata', models.JSONField(default=dict, help_text='Additional metadata')),
                ('trust_principal_type', models.CharField(choices=[('user', 'IAM User'), ('service', 'AWS-like Service Principal'), ('federated', 'Federated Identity'), ('cross_account', 'Cross-Account')], default='user', max_length=32)),
                ('trust_policy', models.JSONField(default=dict, help_text='Trust relationship policy document')),
                ('permission_policies', models.JSONField(default=list, help_text='Attached permission policy IDs')),
                ('max_session_duration_hours', models.IntegerField(default=1)),
                ('is_service_role', models.BooleanField(default=False)),
                ('last_used', models.DateTimeField(blank=True, null=True)),
                ('owner', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='%(class)s_owned', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'IAM Role',
                'verbose_name_plural': 'IAM Roles',
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='IAMUserProfile',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('console_access', models.BooleanField(default=True)),
                ('programmatic_access', models.BooleanField(default=True)),
                ('mfa_enforced', models.BooleanField(default=False)),
                ('mfa_enabled', models.BooleanField(default=False)),
                ('password_last_changed', models.DateTimeField(blank=True, null=True)),
                ('password_never_expires', models.BooleanField(default=False)),
                ('last_login_ip', models.GenericIPAddressField(blank=True, null=True)),
                ('groups_list', models.ManyToManyField(blank=True, related_name='user_profiles', to='services.iamgroup')),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='iam_profile', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'IAM User Profile',
            },
        ),
        migrations.CreateModel(
            name='KMSEncryptionKey',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('resource_id', models.CharField(db_index=True, editable=False, max_length=64, unique=True)),
                ('name', models.CharField(db_index=True, max_length=255)),
                ('description', models.TextField(blank=True, null=True)),
                ('tags', models.JSONField(default=dict, help_text='Key-value tags for resource')),
                ('metadata', models.JSONField(default=dict, help_text='Additional metadata')),
                ('key_id', models.CharField(db_index=True, editable=False, max_length=64, unique=True)),
                ('key_type', models.CharField(choices=[('symmetric', 'Symmetric (AES-256)'), ('asymmetric', 'Asymmetric (RSA-4096)'), ('hmac', 'HMAC')], default='symmetric', max_length=20)),
                ('key_usage', models.CharField(choices=[('encrypt_decrypt', 'Encrypt / Decrypt'), ('sign_verify', 'Sign / Verify'), ('generate_mac_verify', 'Generate & Verify MAC')], default='encrypt_decrypt', max_length=30)),
                ('status', models.CharField(choices=[('enabled', 'Enabled'), ('disabled', 'Disabled'), ('pending_deletion', 'Pending Deletion'), ('pending_import', 'Pending Import'), ('unavailable', 'Unavailable')], db_index=True, default='enabled', max_length=30)),
                ('key_material_origin', models.CharField(choices=[('atonix', 'AtonixCorp'), ('external', 'External'), ('custom_key_store', 'Custom Key Store')], default='atonix', max_length=20)),
                ('alias', models.CharField(blank=True, db_index=True, max_length=255)),
                ('rotation_enabled', models.BooleanField(default=True)),
                ('rotation_period_days', models.IntegerField(default=365)),
                ('next_rotation_date', models.DateField(blank=True, null=True)),
                ('deletion_date', models.DateTimeField(blank=True, null=True)),
                ('deletion_window_days', models.IntegerField(default=30)),
                ('policy', models.JSONField(default=dict, help_text='Key policy document')),
                ('owner', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='%(class)s_owned', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Encryption Key',
                'verbose_name_plural': 'Encryption Keys',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='KeyRotationRecord',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('rotation_type', models.CharField(choices=[('automatic', 'Automatic'), ('manual', 'Manual')], default='automatic', max_length=20)),
                ('previous_key_version', models.CharField(blank=True, max_length=64)),
                ('new_key_version', models.CharField(blank=True, max_length=64)),
                ('status', models.CharField(default='success', max_length=20)),
                ('notes', models.TextField(blank=True)),
                ('rotated_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('key', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='rotation_records', to='services.kmsencryptionkey')),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='MFADevice',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('device_type', models.CharField(choices=[('totp', 'Authenticator App (TOTP)'), ('fido2', 'Security Key (FIDO2/WebAuthn)'), ('sms', 'SMS'), ('email', 'Email OTP')], default='totp', max_length=20)),
                ('device_name', models.CharField(max_length=100)),
                ('is_active', models.BooleanField(db_index=True, default=True)),
                ('last_used', models.DateTimeField(blank=True, null=True)),
                ('serial', models.CharField(blank=True, help_text='Device serial / credential_id (FIDO2)', max_length=255)),
                ('owner', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='mfa_devices', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='Secret',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('resource_id', models.CharField(db_index=True, editable=False, max_length=64, unique=True)),
                ('name', models.CharField(db_index=True, max_length=255)),
                ('description', models.TextField(blank=True, null=True)),
                ('tags', models.JSONField(default=dict, help_text='Key-value tags for resource')),
                ('metadata', models.JSONField(default=dict, help_text='Additional metadata')),
                ('secret_id', models.CharField(db_index=True, editable=False, max_length=64, unique=True)),
                ('secret_type', models.CharField(choices=[('password', 'Password'), ('api_key', 'API Key'), ('database', 'Database Credentials'), ('tls_certificate', 'TLS Certificate'), ('ssh_key', 'SSH Key'), ('oauth_token', 'OAuth Token'), ('generic', 'Generic')], default='generic', max_length=30)),
                ('status', models.CharField(choices=[('active', 'Active'), ('deprecated', 'Deprecated'), ('scheduled_delete', 'Scheduled for Deletion'), ('deleted', 'Deleted')], db_index=True, default='active', max_length=30)),
                ('kms_key_id', models.CharField(blank=True, help_text='KMS key used to encrypt', max_length=64)),
                ('rotation_enabled', models.BooleanField(default=False)),
                ('rotation_lambda_arn', models.CharField(blank=True, max_length=255)),
                ('rotation_days', models.IntegerField(default=90)),
                ('next_rotation_date', models.DateField(blank=True, null=True)),
                ('last_rotated_date', models.DateField(blank=True, null=True)),
                ('expiry_date', models.DateTimeField(blank=True, null=True)),
                ('deletion_scheduled_for', models.DateTimeField(blank=True, null=True)),
                ('replication_regions', models.JSONField(default=list)),
                ('resource_policy', models.JSONField(default=dict)),
                ('last_accessed', models.DateTimeField(blank=True, null=True)),
                ('last_changed', models.DateTimeField(blank=True, null=True)),
                ('owner', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='%(class)s_owned', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Secret',
                'verbose_name_plural': 'Secrets',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='SecretVersion',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('version_id', models.CharField(editable=False, max_length=64, unique=True)),
                ('status', models.CharField(choices=[('current', 'Current (AWSCURRENT)'), ('previous', 'Previous (AWSPREVIOUS)'), ('pending', 'Pending (AWSPENDING)'), ('deprecated', 'Deprecated')], db_index=True, default='current', max_length=20)),
                ('value_cipher_ref', models.CharField(blank=True, help_text='Reference to encrypted value in vault backend', max_length=512)),
                ('rotation_triggered', models.BooleanField(default=False)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('secret', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='versions', to='services.secret')),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='ServiceLevelObjective',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('resource_id', models.CharField(db_index=True, editable=False, max_length=64, unique=True)),
                ('name', models.CharField(db_index=True, max_length=255)),
                ('description', models.TextField(blank=True, null=True)),
                ('tags', models.JSONField(default=dict, help_text='Key-value tags for resource')),
                ('metadata', models.JSONField(default=dict, help_text='Additional metadata')),
                ('service', models.CharField(max_length=64)),
                ('slo_type', models.CharField(choices=[('availability', 'Availability'), ('latency', 'Latency'), ('error_rate', 'Error Rate'), ('throughput', 'Throughput'), ('custom', 'Custom')], default='availability', max_length=20)),
                ('target_pct', models.FloatField(default=99.9, help_text='SLO target as percentage')),
                ('window_days', models.IntegerField(default=30, help_text='Rolling window in days')),
                ('current_value', models.FloatField(default=100.0)),
                ('error_budget_pct', models.FloatField(default=100.0, help_text='Remaining error budget %')),
                ('burn_rate', models.FloatField(default=0.0)),
                ('breached', models.BooleanField(default=False)),
                ('last_calculated', models.DateTimeField(blank=True, null=True)),
                ('alert_on_breach', models.BooleanField(default=True)),
                ('alert_at_budget_pct', models.FloatField(default=10.0, help_text='Alert when budget drops below X%')),
                ('owner', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='%(class)s_owned', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'SLO',
                'verbose_name_plural': 'SLOs',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='ZeroTrustPolicy',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('resource_id', models.CharField(db_index=True, editable=False, max_length=64, unique=True)),
                ('name', models.CharField(db_index=True, max_length=255)),
                ('description', models.TextField(blank=True, null=True)),
                ('tags', models.JSONField(default=dict, help_text='Key-value tags for resource')),
                ('metadata', models.JSONField(default=dict, help_text='Additional metadata')),
                ('policy_action', models.CharField(choices=[('allow', 'Allow'), ('deny', 'Deny'), ('mfa_required', 'Allow (MFA Required)'), ('device_check', 'Allow (Device Check Required)')], default='allow', max_length=20)),
                ('status', models.CharField(choices=[('active', 'Active'), ('disabled', 'Disabled'), ('draft', 'Draft')], db_index=True, default='active', max_length=20)),
                ('priority', models.IntegerField(default=100, help_text='Lower = evaluated first')),
                ('subjects', models.JSONField(default=list, help_text='List of user/group/role identifiers')),
                ('resources', models.JSONField(default=list, help_text='Target services/URLs/CIDRs')),
                ('conditions', models.JSONField(default=dict, help_text='Location, device, time conditions')),
                ('matched_count', models.BigIntegerField(default=0)),
                ('last_matched', models.DateTimeField(blank=True, null=True)),
                ('owner', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='%(class)s_owned', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Zero-Trust Policy',
                'verbose_name_plural': 'Zero-Trust Policies',
                'ordering': ['priority', 'name'],
            },
        ),
        migrations.CreateModel(
            name='IAMAuditLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('event_id', models.UUIDField(db_index=True, default=uuid.uuid4, editable=False, unique=True)),
                ('actor_ip', models.GenericIPAddressField(blank=True, null=True)),
                ('actor_arn', models.CharField(blank=True, help_text='Assumed role ARN or user ARN', max_length=255)),
                ('source', models.CharField(choices=[('console', 'Web Console'), ('api', 'API Call'), ('cli', 'CLI'), ('service', 'Service')], default='api', max_length=20)),
                ('event_type', models.CharField(db_index=True, help_text='e.g. iam.CreateUser', max_length=128)),
                ('resource_type', models.CharField(blank=True, max_length=64)),
                ('resource_id', models.CharField(blank=True, max_length=128)),
                ('region', models.CharField(blank=True, max_length=64)),
                ('outcome', models.CharField(choices=[('success', 'Success'), ('failure', 'Failure'), ('denied', 'Denied')], db_index=True, default='success', max_length=20)),
                ('request_params', models.JSONField(default=dict)),
                ('response_code', models.IntegerField(blank=True, null=True)),
                ('error_message', models.TextField(blank=True)),
                ('user_agent', models.TextField(blank=True)),
                ('actor', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='audit_logs', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-created_at'],
                'indexes': [models.Index(fields=['actor', 'created_at'], name='services_ia_actor_i_2035a5_idx'), models.Index(fields=['event_type', 'created_at'], name='services_ia_event_t_8af11b_idx'), models.Index(fields=['outcome', 'created_at'], name='services_ia_outcome_d7afd0_idx')],
            },
        ),
        migrations.CreateModel(
            name='KeyUsageLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('operation', models.CharField(choices=[('encrypt', 'Encrypt'), ('decrypt', 'Decrypt'), ('sign', 'Sign'), ('verify', 'Verify'), ('generate_data_key', 'Generate Data Key'), ('re_encrypt', 'Re-Encrypt')], max_length=30)),
                ('resource_id', models.CharField(blank=True, max_length=128)),
                ('resource_type', models.CharField(blank=True, max_length=64)),
                ('caller_ip', models.GenericIPAddressField(blank=True, null=True)),
                ('region', models.CharField(blank=True, max_length=64)),
                ('outcome', models.CharField(default='success', max_length=20)),
                ('actor', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('key', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='usage_logs', to='services.kmsencryptionkey')),
            ],
            options={
                'ordering': ['-created_at'],
                'indexes': [models.Index(fields=['key', 'created_at'], name='services_ke_key_id_380885_idx')],
            },
        ),
        migrations.CreateModel(
            name='SecretAccessLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('action', models.CharField(choices=[('get_value', 'Get Value'), ('put_value', 'Put Value'), ('rotate', 'Rotate'), ('delete', 'Delete'), ('restore', 'Restore'), ('describe', 'Describe')], max_length=30)),
                ('outcome', models.CharField(default='success', max_length=20)),
                ('actor_ip', models.GenericIPAddressField(blank=True, null=True)),
                ('region', models.CharField(blank=True, max_length=64)),
                ('application', models.CharField(blank=True, max_length=255)),
                ('actor', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('secret', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='access_logs', to='services.secret')),
            ],
            options={
                'ordering': ['-created_at'],
                'indexes': [models.Index(fields=['secret', 'created_at'], name='services_se_secret__7cb464_idx')],
            },
        ),
        migrations.CreateModel(
            name='TraceSpan',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('trace_id', models.CharField(db_index=True, max_length=64)),
                ('span_id', models.CharField(max_length=64, unique=True)),
                ('parent_span_id', models.CharField(blank=True, max_length=64)),
                ('operation_name', models.CharField(max_length=255)),
                ('service_name', models.CharField(db_index=True, max_length=128)),
                ('start_time', models.DateTimeField(db_index=True)),
                ('duration_ms', models.IntegerField(default=0)),
                ('status', models.CharField(choices=[('ok', 'OK'), ('error', 'Error'), ('timeout', 'Timeout')], default='ok', max_length=20)),
                ('tags', models.JSONField(default=dict)),
                ('logs', models.JSONField(default=list)),
                ('error_message', models.TextField(blank=True)),
                ('http_method', models.CharField(blank=True, max_length=10)),
                ('http_url', models.CharField(blank=True, max_length=512)),
                ('http_status_code', models.IntegerField(blank=True, null=True)),
                ('db_type', models.CharField(blank=True, max_length=32)),
                ('db_statement', models.TextField(blank=True)),
                ('owner', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='trace_spans', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-start_time'],
                'indexes': [models.Index(fields=['trace_id', 'start_time'], name='services_tr_trace_i_59cbf3_idx'), models.Index(fields=['service_name', 'start_time'], name='services_tr_service_be95e9_idx'), models.Index(fields=['owner', 'start_time'], name='services_tr_owner_i_4b0aa7_idx')],
            },
        ),
        migrations.CreateModel(
            name='ZeroTrustAccessLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('target_resource', models.CharField(max_length=255)),
                ('target_service', models.CharField(blank=True, max_length=128)),
                ('decision', models.CharField(choices=[('allowed', 'Allowed'), ('denied', 'Denied'), ('mfa_challenged', 'MFA Challenged')], db_index=True, default='allowed', max_length=20)),
                ('reason', models.TextField(blank=True)),
                ('source_ip', models.GenericIPAddressField(blank=True, null=True)),
                ('source_country', models.CharField(blank=True, max_length=64)),
                ('risk_score', models.IntegerField(default=0, help_text='0-100 risk assessment')),
                ('latency_ms', models.IntegerField(default=0)),
                ('actor', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='zt_access_logs', to=settings.AUTH_USER_MODEL)),
                ('device', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='services.deviceposture')),
                ('policy', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='services.zerotrustpolicy')),
            ],
            options={
                'ordering': ['-created_at'],
                'indexes': [models.Index(fields=['actor', 'created_at'], name='services_ze_actor_i_e9a4cb_idx'), models.Index(fields=['decision', 'created_at'], name='services_ze_decisio_867be9_idx')],
            },
        ),
    ]
