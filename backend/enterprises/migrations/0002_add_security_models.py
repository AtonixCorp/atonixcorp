# Generated by Django 5.2.7 on 2025-11-04 20:32

import django.core.validators
import django.db.models.deletion
import django.utils.timezone
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('enterprises', '0001_initial'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='SecurityFramework',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(choices=[('nist_csf', 'NIST Cybersecurity Framework'), ('iso_27001', 'ISO/IEC 27001'), ('cis_benchmark', 'CIS Benchmarks'), ('owasp_top10', 'OWASP Top 10'), ('pci_dss', 'PCI-DSS v3.2.1'), ('hipaa', 'HIPAA'), ('gdpr', 'GDPR'), ('soc2_type2', 'SOC 2 Type II')], max_length=100, unique=True)),
                ('display_name', models.CharField(max_length=255)),
                ('description', models.TextField()),
                ('version', models.CharField(max_length=50)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
            ],
            options={
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='SecurityAudit',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('audit_type', models.CharField(choices=[('internal', 'Internal Audit'), ('external', 'External Audit'), ('pentest', 'Penetration Test'), ('vulnerability_scan', 'Vulnerability Scan'), ('compliance_check', 'Compliance Check'), ('incident_review', 'Incident Review')], max_length=50)),
                ('title', models.CharField(max_length=255)),
                ('description', models.TextField(blank=True)),
                ('status', models.CharField(choices=[('scheduled', 'Scheduled'), ('in_progress', 'In Progress'), ('completed', 'Completed'), ('reviewed', 'Reviewed')], default='scheduled', max_length=20)),
                ('scope', models.TextField(help_text='What systems/areas are covered')),
                ('scheduled_date', models.DateField()),
                ('start_date', models.DateField(blank=True, null=True)),
                ('end_date', models.DateField(blank=True, null=True)),
                ('findings_count', models.IntegerField(default=0)),
                ('critical_findings', models.IntegerField(default=0)),
                ('high_findings', models.IntegerField(default=0)),
                ('medium_findings', models.IntegerField(default=0)),
                ('low_findings', models.IntegerField(default=0)),
                ('report_document', models.FileField(blank=True, null=True, upload_to='security_audits/')),
                ('findings_json', models.JSONField(blank=True, default=list)),
                ('conducted_by', models.CharField(blank=True, max_length=255)),
                ('conducted_by_external', models.BooleanField(default=False)),
                ('remediation_plan', models.TextField(blank=True)),
                ('remediation_deadline', models.DateField(blank=True, null=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('enterprise', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='security_audits', to='enterprises.enterprise')),
            ],
            options={
                'ordering': ['-scheduled_date'],
            },
        ),
        migrations.CreateModel(
            name='EnterpriseSecurityPolicy',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('mfa_required', models.BooleanField(default=True, help_text='Enforce MFA for all users')),
                ('mfa_grace_period_days', models.IntegerField(default=30, help_text='Days before MFA enforcement', validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(90)])),
                ('require_hardware_keys', models.BooleanField(default=False, help_text='Require hardware security keys')),
                ('password_min_length', models.IntegerField(default=14, validators=[django.core.validators.MinValueValidator(8), django.core.validators.MaxValueValidator(128)])),
                ('password_require_uppercase', models.BooleanField(default=True)),
                ('password_require_lowercase', models.BooleanField(default=True)),
                ('password_require_numbers', models.BooleanField(default=True)),
                ('password_require_special_chars', models.BooleanField(default=True)),
                ('password_expiry_days', models.IntegerField(default=90, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(365)])),
                ('password_history_count', models.IntegerField(default=5, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(24)])),
                ('session_timeout_minutes', models.IntegerField(default=15, validators=[django.core.validators.MinValueValidator(5), django.core.validators.MaxValueValidator(480)])),
                ('session_concurrent_limit', models.IntegerField(default=5, validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(50)])),
                ('require_vpn_for_admin', models.BooleanField(default=True)),
                ('encryption_at_rest', models.BooleanField(default=True)),
                ('encryption_algorithm', models.CharField(choices=[('AES-256', 'AES-256'), ('AES-192', 'AES-192'), ('AES-128', 'AES-128')], default='AES-256', max_length=50)),
                ('tls_minimum_version', models.CharField(choices=[('TLS_1_3', 'TLS 1.3'), ('TLS_1_2', 'TLS 1.2')], default='TLS_1_3', max_length=20)),
                ('enable_audit_logging', models.BooleanField(default=True)),
                ('audit_log_retention_days', models.IntegerField(default=365, validators=[django.core.validators.MinValueValidator(30), django.core.validators.MaxValueValidator(2555)])),
                ('log_all_access', models.BooleanField(default=True)),
                ('log_all_changes', models.BooleanField(default=True)),
                ('enforce_least_privilege', models.BooleanField(default=True)),
                ('require_approval_for_privileged_access', models.BooleanField(default=True)),
                ('privileged_access_approval_timeout_hours', models.IntegerField(default=8, validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(72)])),
                ('enforce_network_segmentation', models.BooleanField(default=True)),
                ('enforce_zero_trust', models.BooleanField(default=True)),
                ('require_vpn_for_remote_access', models.BooleanField(default=True)),
                ('enable_vuln_scanning', models.BooleanField(default=True)),
                ('vuln_scan_frequency_days', models.IntegerField(default=7, validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(30)])),
                ('auto_patch_critical', models.BooleanField(default=True)),
                ('patch_window_hours', models.IntegerField(default=24, validators=[django.core.validators.MinValueValidator(4), django.core.validators.MaxValueValidator(168)])),
                ('enable_backups', models.BooleanField(default=True)),
                ('backup_frequency_hours', models.IntegerField(default=4, validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(24)])),
                ('backup_retention_days', models.IntegerField(default=90, validators=[django.core.validators.MinValueValidator(7), django.core.validators.MaxValueValidator(3650)])),
                ('rto_hours', models.IntegerField(default=4, help_text='Recovery Time Objective')),
                ('rpo_minutes', models.IntegerField(default=5, help_text='Recovery Point Objective')),
                ('annual_audit_required', models.BooleanField(default=True)),
                ('penetration_testing_frequency_months', models.IntegerField(default=6, validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(24)])),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('enterprise', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='security_policy', to='enterprises.enterprise')),
                ('updated_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('frameworks', models.ManyToManyField(related_name='enterprise_policies', to='enterprises.securityframework')),
                ('primary_framework', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='primary_policies', to='enterprises.securityframework')),
            ],
            options={
                'verbose_name': 'Enterprise Security Policy',
                'verbose_name_plural': 'Enterprise Security Policies',
            },
        ),
        migrations.CreateModel(
            name='SecurityIncident',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('title', models.CharField(max_length=255)),
                ('description', models.TextField()),
                ('severity', models.CharField(choices=[('critical', 'Critical'), ('high', 'High'), ('medium', 'Medium'), ('low', 'Low')], max_length=20)),
                ('status', models.CharField(choices=[('open', 'Open'), ('investigating', 'Investigating'), ('contained', 'Contained'), ('resolved', 'Resolved'), ('closed', 'Closed')], default='open', max_length=20)),
                ('reported_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('detected_at', models.DateTimeField(blank=True, null=True)),
                ('contained_at', models.DateTimeField(blank=True, null=True)),
                ('resolved_at', models.DateTimeField(blank=True, null=True)),
                ('response_team', models.CharField(blank=True, max_length=255)),
                ('response_actions', models.TextField(blank=True)),
                ('root_cause', models.TextField(blank=True)),
                ('systems_affected', models.JSONField(default=list)),
                ('data_affected', models.TextField(blank=True)),
                ('user_count_affected', models.IntegerField(default=0)),
                ('notification_sent', models.BooleanField(default=False)),
                ('notification_date', models.DateTimeField(blank=True, null=True)),
                ('regulators_notified', models.BooleanField(default=False)),
                ('regulator_notification_date', models.DateTimeField(blank=True, null=True)),
                ('lessons_learned', models.TextField(blank=True)),
                ('improvements_planned', models.JSONField(default=list)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('enterprise', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='security_incidents', to='enterprises.enterprise')),
            ],
            options={
                'ordering': ['-reported_at'],
            },
        ),
        migrations.CreateModel(
            name='SecurityControl',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('control_id', models.CharField(max_length=50)),
                ('name', models.CharField(max_length=255)),
                ('description', models.TextField()),
                ('category', models.CharField(max_length=100)),
                ('status', models.CharField(choices=[('not_implemented', 'Not Implemented'), ('partial', 'Partially Implemented'), ('implemented', 'Implemented'), ('verified', 'Verified'), ('exempted', 'Exempted')], default='not_implemented', max_length=20)),
                ('priority', models.CharField(choices=[('critical', 'Critical'), ('high', 'High'), ('medium', 'Medium'), ('low', 'Low')], default='medium', max_length=20)),
                ('implementation_notes', models.TextField(blank=True)),
                ('evidence_document', models.FileField(blank=True, null=True, upload_to='security_controls/')),
                ('test_results', models.JSONField(blank=True, default=dict)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('verification_date', models.DateTimeField(blank=True, null=True)),
                ('enterprise', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='security_controls', to='enterprises.enterprise')),
                ('verified_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='verified_controls', to=settings.AUTH_USER_MODEL)),
                ('framework', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='enterprises.securityframework')),
            ],
            options={
                'ordering': ['priority', 'category', 'control_id'],
                'unique_together': {('enterprise', 'framework', 'control_id')},
            },
        ),
        migrations.CreateModel(
            name='ComplianceTracker',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('requirement_name', models.CharField(max_length=255)),
                ('description', models.TextField()),
                ('section_reference', models.CharField(blank=True, max_length=100)),
                ('status', models.CharField(choices=[('not_started', 'Not Started'), ('in_progress', 'In Progress'), ('completed', 'Completed'), ('expired', 'Expired'), ('non_compliant', 'Non-Compliant')], default='not_started', max_length=30)),
                ('status_percentage', models.IntegerField(default=0, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                ('deadline', models.DateField()),
                ('completed_date', models.DateField(blank=True, null=True)),
                ('evidence_document', models.FileField(blank=True, null=True, upload_to='compliance_evidence/')),
                ('verification_notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('enterprise', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='compliance_trackers', to='enterprises.enterprise')),
                ('owner', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('framework', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='enterprises.securityframework')),
            ],
            options={
                'ordering': ['deadline'],
                'unique_together': {('enterprise', 'framework', 'requirement_name')},
            },
        ),
        migrations.CreateModel(
            name='SecurityHardeningChecklist',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('system_type', models.CharField(choices=[('linux', 'Linux Systems'), ('windows', 'Windows Systems'), ('container', 'Containers (Docker/Podman)'), ('kubernetes', 'Kubernetes Clusters'), ('database', 'Databases'), ('application', 'Applications'), ('network', 'Network')], max_length=50)),
                ('name', models.CharField(max_length=255)),
                ('description', models.TextField(blank=True)),
                ('items', models.JSONField(default=list, help_text='Array of checklist items')),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('in_progress', 'In Progress'), ('completed', 'Completed'), ('failed', 'Failed')], default='pending', max_length=20)),
                ('completion_percentage', models.IntegerField(default=0, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('last_verified_at', models.DateTimeField(blank=True, null=True)),
                ('enterprise', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='hardening_checklists', to='enterprises.enterprise')),
                ('verified_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='verified_checklists', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['system_type', 'created_at'],
                'unique_together': {('enterprise', 'system_type')},
            },
        ),
    ]
